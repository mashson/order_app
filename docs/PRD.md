## 1. 프로젝트 개요

## 1.1 프로젝트명 커피 주문 앱

## 1.2 프로젝트 목적

사용자가 커피 메뉴를 주문하고, 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱

### 1.3 개발 범위

- 주문하기 화면(메뉴 선택 및 장바구니 기능)
- 관리자 화면(재고 관리 및 주문 상태 관리)
- 데이터를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택

- 프런트엔드: HTML, CSS, 리액트, 자바스크립트
- 백엔드: Node.js, Express
- 데이터베이스: PostgresoL

## 3. 기본 사항

- 프런트엔드와 백엔드를 따로 개발
- 기본적인 웹 기술만 사용
- 학습 목적이므로 사용자 인증이나 결제 기능은 제외
- 메뉴는 커피 메뉴만 있음

## 4. '주문하기' 화면 PRD

### 4.1 화면 개요
사용자가 메뉴를 선택하고 옵션을 추가하여 장바구니에 담은 후 주문할 수 있는 메인 화면입니다.

### 4.2 화면 구성

#### 4.2.1 헤더 영역
- **앱 이름**: 좌측에 "COZY" 표시
- **탭 메뉴**: 우측에 "주문하기", "관리자" 버튼 배치
- **스타일**: 어두운 녹색 배경의 직사각형 바

#### 4.2.2 상품 목록 영역
각 상품 카드에 다음 정보를 표시:

**필수 표시 항목:**
- 상품 이미지 (직사각형 플레이스홀더)
- 상품명 (예: "아메리카노(ICE)", "아메리카노(HOT)", "카페라떼")
- 가격 (예: "4,000원", "5,000원")
- 간단한 설명 (예: "간단한 설명...")

**옵션 선택 기능:**
- "샷 추가 (+500원)" 체크박스
- "시럽 추가 (+0원)" 체크박스

**담기 버튼**: 회색 배경의 "담기" 버튼

#### 4.2.3 장바구니 영역
화면 하단에 고정되는 장바구니 섹션:

**장바구니 헤더:**
- "장바구니" 제목

**담은 상품 목록:**
- 상품명과 옵션, 수량, 개별 가격을 리스트 형태로 표시
  - 예: "아메리카노(ICE) (샷 추가) X 1 - 4,500원"
  - 예: "아메리카노(HOT) X 2 - 8,000원"
- 각 항목의 총 가격을 우측 정렬로 표시

**총액 표시:**
- "총 금액" 레이블과 함께 전체 합계 금액을 굵게 표시
- 예: "총 금액 12,500원"

**주문 버튼:**
- 회색 배경의 "주문하기" 버튼

### 4.3 기능 요구사항

#### 4.3.1 상품 선택 기능
- 각 상품 카드에서 옵션을 체크박스로 선택 가능
- 옵션 선택 시 가격 변경이 실시간으로 장바구니에 반영
- "담기" 버튼 클릭 시 장바구니에 추가

#### 4.3.2 장바구니 관리 기능
- 장바구니에 담긴 상품은 목록으로 표시
- 같은 상품과 옵션 조합은 수량으로 관리 (예: X 2)
- 장바구니 내 상품 수량 조절 기능 (구현 예정)
- 장바구니 총액 자동 계산

#### 4.3.3 주문 기능
- "주문하기" 버튼 클릭 시 주문 완료 처리
- 주문 성공 후 장바구니 초기화

### 4.4 UI/UX 요구사항

#### 4.4.1 레이아웃
- 헤더는 화면 상단에 고정
- 상품 목록은 화면 중앙에 가로 스크롤 또는 그리드 레이아웃
- 장바구니는 화면 하단에 고정되며, 적절한 높이로 표시

#### 4.4.2 색상
- 헤더: 어두운 녹색 (#2D5F3F 또는 유사 색상)
- 버튼: 회색 계열
- 텍스트: 기본 검정색, 중요한 정보(가격, 총액)는 강조 처리

#### 4.4.3 반응형
- 모바일 우선 디자인
- 다양한 화면 크기에 대응 가능한 유연한 레이아웃

### 4.5 데이터 요구사항

#### 4.5.1 상품 데이터 구조
```javascript
{
  id: 상품 고유 ID,
  name: 상품명,
  category: 카테고리,
  price: 기본 가격,
  image: 이미지 URL,
  description: 설명,
  options: [
    { name: 옵션명, price: 추가 가격 }
  ]
}
```

#### 4.5.2 장바구니 데이터 구조
```javascript
{
  items: [
    {
      productId: 상품 ID,
      productName: 상품명,
      options: 선택한 옵션 배열,
      quantity: 수량,
      price: 개별 가격
    }
  ],
  totalPrice: 총 금액
}
```

### 4.6 API 요구사항

#### 4.6.1 필요한 API 엔드포인트
- `GET /api/products` - 상품 목록 조회
- `POST /api/orders` - 주문 생성

### 4.7 상태 관리

#### 4.7.1 필요한 상태
- 상품 목록 상태
- 장바구니 상태 (담긴 상품 목록, 수량, 총액)
- 옵션 선택 상태 (각 상품별)

### 4.8 예외 처리

- 상품 데이터 로딩 실패 시 에러 메시지 표시
- 장바구니가 비어있을 때 주문 버튼 비활성화 또는 안내 메시지 표시
- 중복된 상품 추가 시 수량만 증가하도록 처리

## 5. '관리자' 화면 PRD

### 5.1 화면 개요
관리자가 주문 현황을 모니터링하고, 재고를 관리할 수 있는 관리자 전용 화면입니다.

### 5.2 화면 구성

#### 5.2.1 헤더 영역
- **앱 이름**: 좌측에 "COZY" 표시
- **탭 메뉴**: 우측에 "주문하기", "관리자" 버튼 배치
- **스타일**: 어두운 테두리가 있는 직사각형 영역, "관리자" 탭이 선택된 상태로 표시

#### 5.2.2 관리자 대시보드 영역
회색 박스로 구분된 첫 번째 섹션:

**제목:**
- "관리자 대시보드" 표시

**주문 통계:**
- "총 주문 1 / 주문 접수 1 / 제조 중 0 / 제조 완료 0" 형식으로 표시
- 각 주문 상태별 건수를 한 줄로 요약

#### 5.2.3 재고 현황 영역
회색 박스로 구분된 두 번째 섹션:

**제목:**
- "재고 현황" 표시

**상품별 재고 카드:**
각 상품에 대해 다음을 표시:
- 상품명 (예: "아메리카노(ICE)", "아메리카노(HOT)", "카페라떼")
- 현재 재고 수량 (예: "10개")
- 수량 조절 버튼: "+" 버튼, "-" 버튼
- 회색 박스 내 가로 배치

#### 5.2.4 주문 현황 영역
회색 박스로 구분된 세 번째 섹션:

**제목:**
- "주문 현황" 표시

**주문 목록:**
각 주문 항목에 다음 정보를 표시:
- 주문 시간 (예: "7월 31일 13:00")
- 주문 상품 (예: "아메리카노(ICE) x 1")
- 주문 금액 (예: "4,000원")
- 주문 상태 버튼 (예: "주문 접수")
- 시간 → 상품 → 금액 → 상태 버튼 순서로 가로 배치

### 5.3 기능 요구사항

#### 5.3.1 대시보드 통계 기능
- 실시간으로 주문 통계를 집계하여 표시
- 총 주문 건수 계산
- 주문 상태별 건수 집계 (주문 접수, 제조 중, 제조 완료)
- 새 주문 발생 시 자동 업데이트

#### 5.3.2 재고 관리 기능
- 각 상품의 현재 재고 수량 표시
- "+" 버튼 클릭 시 해당 상품 재고 증가
- "-" 버튼 클릭 시 해당 상품 재고 감소
- 재고 수정 시 즉시 데이터베이스에 반영
- 재고 부족 시 경고 표시 (구현 예정)

#### 5.3.3 주문 관리 기능
- 모든 주문 목록을 시간 역순으로 표시
- 각 주문의 상세 정보 표시 (주문 시간, 상품, 금액)
- 주문 상태 버튼으로 주문 상태 변경
- 주문 상태: "주문 접수" → "제조 중" → "제조 완료"
- 주문 상태 변경 시 대시보드 통계도 자동 업데이트

### 5.4 UI/UX 요구사항

#### 5.4.1 레이아웃
- 헤더는 화면 상단에 고정
- 각 섹션은 회색 박스로 구분하여 가독성 향상
- 대시보드, 재고, 주문 순서로 세로 배치
- 주문 목록은 스크롤 가능하도록 구현

#### 5.4.2 색상
- 헤더: 어두운 테두리로 구분
- 섹션 박스: 연한 회색 배경
- 버튼: 기본 버튼 스타일, 상태별 색상 적용 가능 (구현 예정)

#### 5.4.3 반응형
- 모바일 및 태블릿 크기에 최적화
- 화면 크기에 따라 레이아웃 조정

### 5.5 데이터 요구사항

#### 5.5.1 재고 데이터 구조
```javascript
{
  id: 상품 ID,
  name: 상품명,
  stock: 재고 수량
}
```

#### 5.5.2 주문 데이터 구조
```javascript
{
  id: 주문 ID,
  orderTime: 주문 시간 (ISO 8601 형식),
  items: [
    {
      productId: 상품 ID,
      productName: 상품명,
      quantity: 수량,
      price: 단가
    }
  ],
  totalPrice: 총 금액,
  status: 주문 상태 ("주문 접수", "제조 중", "제조 완료")
}
```

#### 5.5.3 주문 통계 데이터 구조
```javascript
{
  totalOrders: 총 주문 건수,
  receivedOrders: 주문 접수 건수,
  inProgressOrders: 제조 중 건수,
  completedOrders: 제조 완료 건수
}
```

### 5.6 API 요구사항

#### 5.6.1 필요한 API 엔드포인트
- `GET /api/admin/dashboard` - 대시보드 통계 조회
- `GET /api/admin/products` - 상품 목록 조회 (재고 포함)
- `PATCH /api/admin/products/:id/stock` - 재고 수정
- `GET /api/admin/orders` - 주문 목록 조회
- `PATCH /api/admin/orders/:id/status` - 주문 상태 변경

### 5.7 상태 관리

#### 5.7.1 필요한 상태
- 주문 통계 상태 (총 주문, 주문 접수, 제조 중, 제조 완료)
- 재고 상태 (각 상품별 재고 수량)
- 주문 목록 상태 (주문 배열)
- 선택된 주문 상태 (클릭한 주문)

### 5.8 실시간 업데이트

- 새 주문이 생성되면 화면 자동 새로고침 또는 WebSocket으로 실시간 업데이트
- 주문 상태 변경 시 대시보드 통계도 즉시 반영

### 5.9 예외 처리

- 재고를 0보다 작게 조정 시도 시 경고 메시지 표시
- 주문 데이터 로딩 실패 시 에러 메시지 표시
- 주문 상태 변경 실패 시 원래 상태로 롤백
- 네트워크 오류 시 재시도 로직 구현

### 5.10 추가 기능 (향후 구현 예정)

- 주문 필터링 기능 (상태별, 날짜별)
- 재고 부족 알림 기능
- 주문 히스토리 검색 기능
- 영업 통계 및 리포트 기능

## 6. 백엔드 개발 PRD

### 6.1 개요
커피 주문 앱의 백엔드 시스템을 구축하여 프론트엔드와 데이터베이스 간의 연동을 담당합니다.

### 6.2 데이터 모델

#### 6.2.1 Menus (메뉴 테이블)
커피 메뉴의 기본 정보를 저장하는 테이블입니다.

**필드 구성:**
- `id` (Primary Key): 메뉴 고유 식별자
- `name` (String, NOT NULL): 커피 이름 (예: "아메리카노(ICE)")
- `description` (Text): 메뉴 설명
- `price` (Integer, NOT NULL): 기본 가격 (원 단위)
- `image_url` (String): 이미지 파일 경로
- `stock_quantity` (Integer, DEFAULT 0): 재고 수량
- `is_available` (Boolean, DEFAULT true): 판매 가능 여부
- `created_at` (Timestamp): 생성 일시
- `updated_at` (Timestamp): 수정 일시

#### 6.2.2 Options (옵션 테이블)
메뉴에 추가할 수 있는 옵션 정보를 저장하는 테이블입니다.

**필드 구성:**
- `id` (Primary Key): 옵션 고유 식별자
- `menu_id` (Foreign Key): 연결할 메뉴 ID
- `name` (String, NOT NULL): 옵션 이름 (예: "샷 추가", "시럽 추가")
- `price` (Integer, DEFAULT 0): 옵션 추가 가격 (원 단위)
- `is_available` (Boolean, DEFAULT true): 옵션 사용 가능 여부
- `created_at` (Timestamp): 생성 일시
- `updated_at` (Timestamp): 수정 일시

#### 6.2.3 Orders (주문 테이블)
고객의 주문 정보를 저장하는 테이블입니다.

**필드 구성:**
- `id` (Primary Key): 주문 고유 식별자
- `order_time` (Timestamp, NOT NULL): 주문 일시
- `total_price` (Integer, NOT NULL): 총 주문 금액 (원 단위)
- `status` (Enum, DEFAULT 'received'): 주문 상태
  - `received`: 주문 접수
  - `in_progress`: 제조 중
  - `completed`: 제조 완료
  - `cancelled`: 주문 취소
- `created_at` (Timestamp): 생성 일시
- `updated_at` (Timestamp): 수정 일시

#### 6.2.4 Order_Items (주문 상세 테이블)
각 주문에 포함된 메뉴와 옵션의 상세 정보를 저장하는 테이블입니다.

**필드 구성:**
- `id` (Primary Key): 주문 상세 고유 식별자
- `order_id` (Foreign Key): 주문 ID
- `menu_id` (Foreign Key): 메뉴 ID
- `quantity` (Integer, NOT NULL): 주문 수량
- `unit_price` (Integer, NOT NULL): 단가 (옵션 포함)
- `subtotal` (Integer, NOT NULL): 소계 (단가 × 수량)
- `selected_options` (JSON): 선택된 옵션 정보
- `created_at` (Timestamp): 생성 일시

### 6.3 데이터베이스 관계

```
Menus (1) ←→ (N) Options
Orders (1) ←→ (N) Order_Items
Menus (1) ←→ (N) Order_Items
```

### 6.4 사용자 흐름 및 데이터 처리

#### 6.4.1 메뉴 조회 흐름
1. 사용자가 '주문하기' 화면 접속
2. 프론트엔드에서 `GET /api/menus` 요청
3. 백엔드에서 Menus 테이블과 Options 테이블 조인하여 데이터 반환
4. 재고 수량(`stock_quantity`)은 관리자 화면에서만 표시

#### 6.4.2 주문 처리 흐름
1. 사용자가 메뉴 선택 및 옵션 추가
2. 장바구니에서 '주문하기' 버튼 클릭
3. 프론트엔드에서 `POST /api/orders` 요청으로 주문 데이터 전송
4. 백엔드에서 다음 순서로 처리:
   - Orders 테이블에 주문 기본 정보 저장
   - Order_Items 테이블에 주문 상세 정보 저장
   - Menus 테이블의 재고 수량(`stock_quantity`) 차감
5. 주문 완료 응답 반환

#### 6.4.3 관리자 화면 데이터 흐름
1. 관리자가 '관리자' 화면 접속
2. 프론트엔드에서 다음 API 요청:
   - `GET /api/admin/dashboard` - 주문 통계
   - `GET /api/admin/inventory` - 재고 현황
   - `GET /api/admin/orders` - 주문 목록
3. 주문 상태 변경 시 `PATCH /api/admin/orders/:id` 요청

### 6.5 API 설계

#### 6.5.1 메뉴 관련 API

**GET /api/menus**
- 설명: 전체 메뉴 목록 조회 (옵션 포함)
- 응답 예시:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "아메리카노(ICE)",
      "description": "진한 에스프레소에 시원한 얼음과 물을 더한 음료",
      "price": 4000,
      "image_url": "/images/americano-ice.jpg",
      "is_available": true,
      "options": [
        {
          "id": 1,
          "name": "샷 추가",
          "price": 500
        },
        {
          "id": 2,
          "name": "시럽 추가",
          "price": 0
        }
      ]
    }
  ]
}
```

**GET /api/menus/:id**
- 설명: 특정 메뉴 상세 정보 조회
- 매개변수: `id` (메뉴 ID)

#### 6.5.2 주문 관련 API

**POST /api/orders**
- 설명: 새 주문 생성
- 요청 본문:
```json
{
  "items": [
    {
      "menu_id": 1,
      "quantity": 2,
      "selected_options": [1],
      "unit_price": 4500
    }
  ],
  "total_price": 9000
}
```
- 응답 예시:
```json
{
  "success": true,
  "data": {
    "order_id": 123,
    "order_time": "2024-07-31T13:00:00Z",
    "total_price": 9000,
    "status": "received"
  }
}
```

**GET /api/orders/:id**
- 설명: 특정 주문 정보 조회
- 매개변수: `id` (주문 ID)
- 응답 예시:
```json
{
  "success": true,
  "data": {
    "id": 123,
    "order_time": "2024-07-31T13:00:00Z",
    "total_price": 9000,
    "status": "received",
    "items": [
      {
        "menu_name": "아메리카노(ICE)",
        "quantity": 2,
        "selected_options": ["샷 추가"],
        "subtotal": 9000
      }
    ]
  }
}
```

#### 6.5.3 관리자 API

**GET /api/admin/dashboard**
- 설명: 관리자 대시보드 통계 조회
- 응답 예시:
```json
{
  "success": true,
  "data": {
    "total_orders": 15,
    "received_orders": 3,
    "in_progress_orders": 2,
    "completed_orders": 10
  }
}
```

**GET /api/admin/inventory**
- 설명: 재고 현황 조회
- 응답 예시:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "아메리카노(ICE)",
      "stock_quantity": 10,
      "is_available": true
    }
  ]
}
```

**PATCH /api/admin/inventory/:id**
- 설명: 재고 수량 수정
- 매개변수: `id` (메뉴 ID)
- 요청 본문:
```json
{
  "stock_quantity": 15
}
```

**GET /api/admin/orders**
- 설명: 전체 주문 목록 조회 (관리자용)
- 쿼리 매개변수: `status`, `page`, `limit`

**PATCH /api/admin/orders/:id**
- 설명: 주문 상태 변경
- 매개변수: `id` (주문 ID)
- 요청 본문:
```json
{
  "status": "in_progress"
}
```

### 6.6 비즈니스 로직

#### 6.6.1 재고 관리 로직
- 주문 생성 시 해당 메뉴의 재고 수량 자동 차감
- 재고가 0이 되면 `is_available` 필드를 `false`로 변경
- 관리자가 재고 추가 시 `is_available` 필드를 `true`로 복원

#### 6.6.2 주문 상태 관리 로직
- 새 주문 생성 시 기본 상태는 `received` (주문 접수)
- 상태 변경 순서: `received` → `in_progress` → `completed`
- 취소는 `received` 상태에서만 가능

#### 6.6.3 데이터 검증 로직
- 주문 생성 시 재고 수량 확인
- 메뉴 ID와 옵션 ID의 유효성 검증
- 가격 계산 검증 (프론트엔드 계산과 백엔드 계산 일치 확인)

### 6.7 에러 처리

#### 6.7.1 HTTP 상태 코드
- `200 OK`: 성공적인 요청
- `201 Created`: 리소스 생성 성공
- `400 Bad Request`: 잘못된 요청 데이터
- `404 Not Found`: 리소스를 찾을 수 없음
- `409 Conflict`: 재고 부족 등 비즈니스 로직 충돌
- `500 Internal Server Error`: 서버 내부 오류

#### 6.7.2 에러 응답 형식
```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_STOCK",
    "message": "재고가 부족합니다.",
    "details": {
      "menu_id": 1,
      "requested_quantity": 5,
      "available_quantity": 2
    }
  }
}
```

### 6.8 보안 고려사항

#### 6.8.1 입력 데이터 검증
- SQL Injection 방지를 위한 매개변수화된 쿼리 사용
- XSS 방지를 위한 입력 데이터 이스케이프 처리
- 데이터 타입 및 범위 검증

#### 6.8.2 관리자 API 보안
- 관리자 API에 대한 인증/인가 체계 (향후 구현)
- 민감한 데이터 접근 로깅

### 6.9 성능 최적화

#### 6.9.1 데이터베이스 최적화
- 자주 조회되는 컬럼에 인덱스 생성
- 메뉴 조회 시 옵션 정보 조인 최적화
- 주문 통계 조회 시 집계 쿼리 최적화

#### 6.9.2 캐싱 전략
- 메뉴 정보 캐싱 (변경 빈도가 낮음)
- 관리자 대시보드 통계 캐싱

### 6.10 개발 우선순위

#### Phase 1 (핵심 기능)
1. 데이터베이스 스키마 생성
2. 메뉴 조회 API
3. 주문 생성 API
4. 기본적인 관리자 API

#### Phase 2 (관리 기능)
1. 재고 관리 API
2. 주문 상태 변경 API
3. 관리자 대시보드 API

#### Phase 3 (최적화)
1. 에러 처리 고도화
2. 성능 최적화
3. 로깅 및 모니터링